---
import { getCollection, getEntry } from "astro:content";
import Layout from "../../layouts/Layout.astro";
import Header from "../../components/Header.astro";
import Footer from "../../components/Footer.astro";
import DynamicForm from "../../components/forms/DynamicForm.astro";

// Generar rutas estáticas para todos los formularios
export async function getStaticPaths() {
	const forms = await getCollection("forms");
	return forms.map((form) => ({
		params: { id: form.slug },
	}));
}

const { id } = Astro.params;

const form = await getEntry("forms", id!);

if (!form) {
	return Astro.redirect("/404");
}

const { data } = form;

// SEO optimizado
const seoTitle = `${data.title} - Llenado de Formularios | M-Migration LLC`;
const seoDescription = `${data.description} Ayuda profesional para completar ${data.title}. Contacto: +1 (646) 427-2634`;
const seoKeywords = `${data.title}, formularios migratorios, inmigración USA, M-Migration LLC, llenado formularios`;
---

<Layout
	title={seoTitle}
	description={seoDescription}
	keywords={seoKeywords}
	openGraph={{
		title: seoTitle,
		description: seoDescription,
		type: "website",
		image: "/og-image.jpg",
		url: `https://m-migration.com/formularios/${form.slug}`,
	}}
>
	<Header slot="header" />

	<!-- Hero Section -->
	<section
		class="relative min-h-[40vh] bg-black flex items-center justify-center overflow-hidden"
	>
		<div class="absolute inset-0 z-0 opacity-30">
			<div
				class="w-full h-full bg-cover bg-center opacity-30"
				style="background-image: url('/aerial-view-of-statue-of-liberty-new-york-city-sky.jpg');"
			>
			</div>
		</div>

		<!-- Content -->
		<div class="relative z-50 text-center px-4 max-w-6xl mx-auto py-12">
			<div
				class={`inline-flex p-4 rounded-2xl bg-linear-to-br ${data.color} mb-6`}
			>
				{
					data.icon === "briefcase" && (
						<svg
							class="w-12 h-12 text-white"
							fill="none"
							stroke="currentColor"
							viewBox="0 0 24 24"
						>
							<path
								stroke-linecap="round"
								stroke-linejoin="round"
								stroke-width="2"
								d="M21 13.255A23.931 23.931 0 0112 15c-3.183 0-6.22-.62-9-1.745M16 6V4a2 2 0 00-2-2h-4a2 2 0 00-2 2v2m4 6h.01M5 20h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"
							/>
						</svg>
					)
				}
				{
					data.icon === "shield" && (
						<svg
							class="w-12 h-12 text-white"
							fill="none"
							stroke="currentColor"
							viewBox="0 0 24 24"
						>
							<path
								stroke-linecap="round"
								stroke-linejoin="round"
								stroke-width="2"
								d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"
							/>
						</svg>
					)
				}
				{
					data.icon === "users" && (
						<svg
							class="w-12 h-12 text-white"
							fill="none"
							stroke="currentColor"
							viewBox="0 0 24 24"
						>
							<path
								stroke-linecap="round"
								stroke-linejoin="round"
								stroke-width="2"
								d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"
							/>
						</svg>
					)
				}
				{
					data.icon === "home" && (
						<svg
							class="w-12 h-12 text-white"
							fill="none"
							stroke="currentColor"
							viewBox="0 0 24 24"
						>
							<path
								stroke-linecap="round"
								stroke-linejoin="round"
								stroke-width="2"
								d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"
							/>
						</svg>
					)
				}
				{
					data.icon === "file" && (
						<svg
							class="w-12 h-12 text-white"
							fill="none"
							stroke="currentColor"
							viewBox="0 0 24 24"
						>
							<path
								stroke-linecap="round"
								stroke-linejoin="round"
								stroke-width="2"
								d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"
							/>
						</svg>
					)
				}
				{
					data.icon === "help" && (
						<svg
							class="w-12 h-12 text-white"
							fill="none"
							stroke="currentColor"
							viewBox="0 0 24 24"
						>
							<path
								stroke-linecap="round"
								stroke-linejoin="round"
								stroke-width="2"
								d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
							/>
						</svg>
					)
				}
			</div>

			<h1 class="text-5xl md:text-7xl font-bold text-white mb-6">
				{data.title}
			</h1>

			<p class="text-xl text-white/80 max-w-3xl mx-auto">
				{data.description}
			</p>
		</div>
	</section>

	<!-- Form Section -->
	<DynamicForm fields={data.fields} formId={form.slug} requiredFiles={data.requiredFiles} photoRequirements={data.photoRequirements} />

	<Footer slot="footer" />
</Layout>
